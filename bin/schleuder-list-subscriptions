#!/usr/bin/ruby

if ARGV.size != 1 || ARGV.first.match(/^-h|--help/)
  puts <<EOF
This script lists subscriptions of a schleuder-list. First value per row is the
subscribed address, second value is the configured GnuPG-fingerprint.
Usage: #{File.basename(__FILE__)} list@hostname"
EOF
  exit 1
end

require_relative '../lib/schleuder.rb'

listname = ARGV.first

list = List.where(email: listname).first

if list.blank?
  puts "No such list."
  exit 1
end

strings = list.subscriptions.map do |subscription|
  "#{subscription.email}\t#{subscription.fingerprint.presence || 'N/A'}"
end.join("\n")

puts strings
